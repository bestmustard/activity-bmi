---
title: "Physical activity is as tied to obesity as we expect it to be"
subtitle: "An analysis of American exerise habits and their BMI"
author: 
  - Victor Ma
thanks: "Code and data are available at: https://github.com/bestmustard/activity-bmi"
date: 03/16/2024
date-format: long
abstract: ""
format: pdf
number-sections: true
bibliography: references.bib
editor: 
  markdown: 
    wrap: 72
    
header-includes:
 \usepackage{float}
 \floatplacement{figure}{H}
---

```{r}
#| include: false
#| warning: false
#| message: false

library(tidyverse)
library(dataverse)
library(knitr)
library(modelsummary)
library(rstanarm)
library(tidybayes)
library(dplyr)
library(patchwork)
library(ggplot2)
library(broom.mixed)
activity_data <- read_csv("../inputs/data/analysis_data/analysis_data.csv")
activity_data$obese = as_factor(activity_data$obese)
activity_data$activity = factor(
      activity_data$activity,
      levels = c("No Activity", "Strength", "Cardio", "Cardio + Strength", "Double Cardio")
    )
```

# Introduction
In the context of public health crises, the term 'pandemic' comes with the connotation of infectious diseases sweeping across global populations. Yet, the United States finds itself grappling with a pandemic of a different nature, with similarly far-reaching consequences: obesity. It is no secret that obesity comes with a multitude of direct health impacts- including increased risk of stroke, high blood pressure, type 2 diabetes, and even mental health problems like clinical depression and anxiety [@cdc]. Obesity is recognized as a chronic complex disease defined by excessive fat deposits that can impair health. In particular, individuals with a Body Mass Index (BMI) of 30 or above are considered obese.

America's problem with obesity is long-lasting, with a 30.5% rate of obesity observed in the early 2000s [@obesityfacts]. Marketing companies have taken advantage of this disease through the spreading of false information, in the form of fad diets, devices and products tied to fat loss, and misleading nutritional claims that often prioritize profit over health. In the modern era, fitness knowledge has been democratized with the advent of social media and digital platforms aiding in dissemination of health information [@Johnson2019]. Despite this, obesity in America has only gotten worse- increasing to 41.9% in 2020 as one of the top 10 most obese countries in the world [@cdc]. 

Obesity is a multifaceted challenge with ties to lifestyle, socioeconomic factors, and access to health education and resources. In this study I use a logistic regression model in order to predict the odds that an individual is obese based on the amount of physical activity they do per week and their level of income. As logistic regression models are used to model binary outcomes, my outcome will be whether an individual has a BMI of 30 or above or not. 

The data I am using is from the Center of Disease Control and Prevention (CDC), a government-officiated service organization dedicated to health research in the United States. In particular, this dataset contains information on an adult's diet, physical activity, and weight status from CDC's Behavioral Risk Factor Surveillance System- America's premier system for collecting data about health-related risk behaviours conducted through telephone surveys [@dataset]. I will be focusing on the variables of activity level and level of income as explanatory variables in the logistic regression model. The estimand will be the probability that an individual is obese based on these factors.

My report is structured into four main sections following the introduction. In the first section, I describe the data utilized for my analysis, presenting the CDC dataset as well as graphs that show the distribution of the explanatory variables. The second section details the logistic regression model, including the rationale for its use and an interpretation of preliminary findings. Next I will analyse the variables' impact on obesity prevalence through the use of graphs and specific numerics from my results. Finally, I discuss the implications of my findings, address potential weaknesses in my study, and suggest directions for future research. 

This analysis is conducted using R, using several R packages to facilitate my analysis and presentation. This includes tidyverse for data manipulation and visualization, knitr for report generation, modelsummary for model interpretation, and rstanarm for Bayesian regression modeling [@citeR; @Dataverse; @Knitr; @Modelsummary; @Rstanarm; @Tidybayes; @Dplyr]. Some portions including ggplot graphs and the "Discussion" section were written with the help of ChatGPT4 @chatgpt. 
\newpage

# Data

I used a dataset called "Nutrition, Physical Activity, and Obesity - Behavioral Risk Factor Surveillance System" pulled directly from the CDC website [@dataset]. The .csv file obtained from the website contains 93250 data points with the relevant information of an individual's activity level based on their survey response, BMI, and various demographics. The dataset is owned by the Division of Nutrition, Physical Activity, Obesity (DNPAO), a division under the CDC which focuses directly on preventing chronic diseases by promoting better nutrition practices. 

## Source Reliability

The Centers for Disease Control and Prevention (CDC) is recognized as a reliable source for obesity data for several reasons. The CDC's Division of Nutrition, Physical Activity, and Obesity conducts comprehensive surveillance and research to understand and address obesity, focusing on policy and environmental strategies to promote healthy eating and active living. The organization collects data from the largest scale health survey systems in the United States, including both the Behavioral Risk Factor Surveillance System (BRFSS) and the National Health and Nutrition Examination Survey (NHANES) [@cdcdata; @cdcinitiatives].

The BRFSS conducts more than 400,000 interviews annually across the United States, offering state-level estimates of obesity prevalence among other health parameters. The large sample size it offers provides a better understanding of the population when compared to smaller samples [@brfss].

## Limitations

The CDC is a reputable government-associated organization but the data did not come without inherent limitations. As with any telephone survey, respondents are susceptible to lying which would represent false data points. In addition, even if respondents believe they are telling the truth, it is possible that they do not have an accurate measurement of, for example, their activity level. There is no information available about the  methods used to validate this information on the CDC website. 

The data used in this paper does not represent the full dataset, as data points had to be removed for any missing responses. The previously more robust dataset with 93250 data points was reduced to 10218 in this process. The categories available for both the respondent variables do not allow for some details, as the markers for physical activity were very specific. Many individuals may not adhere directly to the possible responses in the survey, and it is impossible to account for individuals who perform more physiccal activity than the provided options. The income levels also do not provide a broad perspective, with the maximum level being $75,000+. There is no evidence or rationale provided regarding why these options were chosen.

## Variables of Interest

### Activity Level 
Physical activity is a determinant of energy expenditure and is fundamentally linked to obesity and weight management. Regular physical activity can significantly reduce the risk of becoming obese by increasing the number of calories the body uses for energy [@hillenergy]. Conversely, sedentary lifestyles are closely associated with obesity due to low energy expenditure. Research has consistently shown that low physical activity levels are predictive of obesity development over time. Incorporating various forms of exercise, including strength training and aerobic activities, can aid in maintaining a healthy weight and preventing obesity [@sallisobesity].

### Income
Income level is a social determinant of health that influences obesity rates. Higher income levels often correlate with better access to healthy foods, recreational facilities, and health services, which can contribute to lower obesity rates [@pickett]. Conversely, lower income levels are associated with limited access to healthy food options, reliance on cheaper, calorie-dense processed foods, and reduced opportunities for physical activity [@drewnowski]. This economic disparity creates environments conducive to obesity development, particularly in communities where affordable healthy options are scarce. Research indicates that socioeconomic status, including income, plays a substantial role in the prevalence and distribution of obesity within populations.

### Other Variables

While I believed nutrition information would have been a suitable variable, the options provided in the dataset were only if the individual had "No Fruits" or "No Vegetables" in their regular diet. I did not think these two options were enough to make relevant conclusions. 

## Data Preparation and Cleaning
The data was first downloaded as a .csv file directly from the CDC website and then saved in parquet format using the arrow package for efficient storage and access [@arrow]. The cleaning process involved filtering for the columns for the relevant variables which were "Topic" ("Physical Activity - Behavior", "Obesity / Weight Status", "Fruits and Vegetables - Behavior"), "Question" (specific responses under the topic), BMI, and Income. 

The respondent variable of activity level was transformed for simplicity. Initially, the possible values included: "Percent of adults who engage in no leisure-time physical activity", "Percent of adults who engage in muscle-strengthening activities on 2 or more days a week", "Percent of adults who achieve at least 150 minutes a week of moderate-intensity aerobic physical activity or 75 minutes a week of vigorous-intensity aerobic activity (or an equivalent combination)"... and so on. I removed the specifics and labelled them "No Activity", "Strength", "Cardio", "Cardio + Strength", "Double Cardio", as the markers of strength or cardio training remained the same throughout (strength meant 2 days of strength training, cardio meant 150 minutes of moderate intensity or 75 minutes of "vigorous-intensity"). "Double Cardio" was named as such since it was defined as double the minutes of cardio as "Cardio". 

"NA" responses were then filtered out in order to make sure each data point contained all the variables used. 

The cleaned dataset was then saved in both CSV and parquet formats.

The distributions for each explanatory variable are illustrated in @fig-activity and @fig-income below:

```{r out.height="20%"}
#| label: fig-activity
#| fig-cap: "Number of respondents at each activity level"
#| echo: false
#| warning: false
#| message: false

ggplot(activity_data, aes(x = activity, fill = activity)) +
  coord_flip()+
  geom_bar() +
  scale_fill_brewer(palette = "Paired") + # More colors for distinction
  theme_minimal() +
  labs(title = "Respondents per Level of Activity",
       y = "Activity Level",
       x = "Count") +
  theme(legend.title = element_blank()) 

```

```{r out.height="20%"}
#| label: fig-income
#| fig-cap: "Number of respondents per income bracket"
#| echo: false
#| warning: false
#| message: false
ggplot(activity_data, aes(x = income)) +
  geom_bar(fill = "#778899") +
  theme_minimal() +
  labs(title = "Respondents per income bracket", x = "Income (Thousands)", y = "Count")+
  theme(legend.title = element_blank()) 

```

@fig-activity tells us that 4-year degree graduates are the most well represented in the polls, followed by high school graduates, people with some college, and then 2-year degree graduates. People who have not graduated high school are hardly represented at all.

In @fig-income we see 45-64 being the most dominant age group, with much less representation in the 18-29 range. Also, about 20% more females participated in the study than males. 

Below are some figures representing who people voted for based on their age and gender, followed by education level and gender.

```{r out.height="20%"}
#| label: fig-activityobesity
#| fig-cap: "Prevalence of obesity by activity level"
#| echo: false
#| warning: false
#| message: false

# Relationship between Obesity and Activity Level
ggplot(activity_data, aes(x = activity, fill = obese)) +
  geom_bar(position = "fill") +
  scale_fill_brewer(palette = "Set1") +
  theme_minimal() +
  labs(title = "Obesity Proportion by Activity Levels", x = "Activity Level", y = "Proportion")
```
@fig-activityobesity shows a negative correlation between votes for Joe Biden and older age groups.
```{r out.height="20%"}
#| label: fig-incomeobesity
#| fig-cap: "Prevalence of obesity by income level"
#| echo: false
#| warning: false
#| message: false
ggplot(activity_data, aes(x = income, fill = obese)) +
  geom_bar(position = "fill") +
  scale_fill_brewer(palette = "Set1") +
  theme_minimal() +
  labs(title = "Obesity Proportion by Income Brackets", x = "Age Group", y = "Proportion")
```
We can see that in @fig-gendervotes, more women voted for Joe Biden than men. 

# Model

Logistic regression is a model used when the outcome or dependent variable is binary, which fits this scenario perfectly as I am modelling the binary outcome of below 30 BMI or a BMI of 30 and above.

The regression model will calculate the log odds of the probability that a person has a BMI of 30 or above, and then map it to a probability between 0 and 1 through the logistic function.

The standard logistic function $\sigma(t)$ for a real-valued input $t$ is defined as:

```{=tex}
\[ \sigma(t) = \frac{1}{1 + e^{-t}} \]
```

The graph of the logistic function is an S-shaped curve known as a sigmoid curve. It approaches 1 as $t$ goes to positive infinity and approaches 0 as $t$ goes to negative infinity.

In logistic regression, the input $t$ is the linear combination of predictors including the intercept, which can be represented as $\beta_0 + \beta_1X_1 + \beta_2X_2 + ... + \beta_nX_n$. The logistic function then translates this into a probability that the dependent variable is 1 (has a BMI above 30).

In this situation, I will be using the predictors activity level and income and then applying the logistic function to get the probability $P(Y_i=1)$ that a respondent $i$ is considered obese. 

This model is particularly strong at handling categorical dependent variables, which each of my explanatory variables fall under [@Hosmer2013].

## Model Specification

The logistic regression model is defined as:

```{=tex}
\[
\log\left(\frac{P(Y_i=1)}{1 - P(Y_i=1)}\right) = \beta_0 + \beta_1X_{\text{activity},i} + \beta_2X_{\text{income},i}
\]
```
## Model set-up

- $Y_i$ is the binary indicator of having a BMI of 30 or above (1) versus a BMI below 30 for respondent $i$.
- $X_{\text{activity},i}$, $X_{\text{income},i}$ are the activity level and income of respondent $i$, respectively.
- $\beta_0$ represents the model intercept, while $\beta_1$ and $\beta_2$ are coefficients quantifying the effects of activity level and income on the likelihood of being considered obese. 

I fit my logistic regression model to the data using 'stan_glm()' function from the 'rstanarm' package in R [@citeR, @Rstanarm]. This function will automatically determine each of the $\beta$ coefficients in the model, using a smaller slice sample of 3000 from the data we processed. This function also uses Bayesian logistic regression with the default priors from 'rstanarm'.

### Model Justification

After creating the model, we can examine the summary in @fig-summary:

```{r}
#| label: fig-summary
#| fig-cap: "Model summary"
#| echo: false
#| warning: false
#| message: false
obesity_likelihood <- readRDS(file ="../models/obesity_likelihood.rds")

modelsummary(obesity_likelihood)
```

In order to better interpret the results of the model, I can create a coefficient plot to visually see the effect sizes of the predictor variables on the likelihood of an individual supporting Biden. 

@fig-coefficient maps each predictor variable on the y-axis to an effect size and confidence interval on the x-axis. The effect size is the change in log-odds of supporting Biden for a one-unit increase in the predictor variable, which is essentially how much impact each demographic characterstic has an effect on voting for Biden. 

The confidence intervals tell us the range within we can be confident that the true effect lies. Smaller confidence intervals means there is a higher level of precision in the estimate of the effect size. I am not as interested in the intervals that cross zero because that means that there is data to support each side (Biden or Trump) and so they are less statistically significant. 




```{r}
#| label: fig-coefficient
#| fig-cap: "Coefficient plot of demographics"
#| echo: false
#| warning: false
#| message: false
obesity_likelihood <- readRDS(file ="../models/obesity_likelihood.rds")

# Assuming `tidy_obesity_likelihood` is a tidy version of your model with terms and estimate
tidy_obesity_likelihood <- tidy(obesity_likelihood)

ggplot(tidy_obesity_likelihood, aes(x = term, y = estimate)) +
  geom_point(aes(color = estimate > 0), size = 4) +  # color points based on positive or negative coefficient
  geom_errorbar(aes(ymin = estimate - std.error, ymax = estimate + std.error), width = 0.2) +  #error bars
  coord_flip() +  
  scale_color_manual(values = c("green", "yellow")) +  # Set colors for positive and negative coefficients
  labs(title = "Obesity Likelihood",
       x = "Predictor Variables",
       y = "Effect on Log Odds of Being Considered Obese",
       color = "Effect Direction") +
  theme_minimal()  # Use a minimal theme

# Ensure the 'tidy_obesity_likelihood' contains the columns you want to summarize
tidy_obesity_likelihood <- broom::tidy(obesity_likelihood)

# Check available columns
names(tidy_obesity_likelihood)
```

The conclusions I can draw from @fig-coefficient align with what I expected given the dataset. It's clear that higher education levels, specifically 4-year degrees and post-grad degrees, are positively associated with support for Biden. Higher age groups, specifically 45-64 and 65+, are strongly tied to voting for Trump. Men are less likely to vote for Biden than Women. 

\newpage
# Results

Figures @fig-page, @fig-pgender, and @fig-pedu are recreations of the earlier graphs we saw showcasing the proportion of voters for Joe Biden by groups within each demographic, where the bar is the data from CCES 2020 while the point is the prediction generated by the model. 

```{r out.height="25%"}
#| label: fig-pactivity
#| fig-cap: "Model prediction for obesity by income level vs. CDC data"
#| echo: false
#| warning: false
#| message: false
constant_activity <- "No Activity" # Choose a representative value

income_data <- data.frame(income = c("0-15", "15-25", "25-35", "35-50", "50-75", "75+"),
                       activity = constant_activity)

income_data$predicted_prob <- predict(obesity_likelihood, newdata = income_data, type = "response")
library(ggplot2)
activity_data_grouped <- activity_data %>%
  group_by(income) %>%
  summarize(Obesity_Prediction = mean(obese == "Yes", na.rm = TRUE))

income_data$income <- factor(income_data$income, levels = c("0-15", "15-25", "25-35", "35-50", "50-75", "75+"))

ggplot() +
  geom_bar(data = activity_data_grouped, aes(x = income, y = Obesity_Prediction, fill = income), 
           stat = "identity", position = "dodge", alpha = 0.5) +
  geom_point(data = income_data, aes(x = income, y = predicted_prob, color = income), 
             position = position_dodge(width = 0.9), size = 3) +
  scale_fill_brewer(palette = "Set1") + 
  scale_color_brewer(palette = "Set1") + 
  labs(title = "Actual vs. Predicted Obesity by Income Level",
       x = "Income Level", y = "Proportion") +
  theme_minimal() +
  theme(legend.position = "none") 

```

```{r out.height="25%"}
#| label: fig-pobesity
#| fig-cap: "Model prediction for obesity by activity level vs. CDC data"
#| echo: false
#| warning: false
#| message: false
# Example constant values for the other factors (choose representative values for each)
constant_income <- "35-50" # Choose a representative value

activity_plot_data <- data.frame(activity = c("No Activity", "Strength", "Cardio", "Cardio + Strength", "Double Cardio"),
                       income = constant_income)

activity_plot_data$predicted_prob <- predict(obesity_likelihood, newdata = activity_plot_data, type = "response")
library(ggplot2)
activity_data_grouped <- activity_data %>%
  group_by(activity) %>%
  summarize(Obesity_Prediction = mean(obese == "Yes", na.rm = TRUE))

activity_plot_data$activity <- factor(activity_plot_data$activity, levels = c("No Activity", "Strength", "Cardio", "Cardio + Strength", "Double Cardio"))

ggplot() +
  geom_bar(data = activity_data_grouped, aes(x = activity, y = Obesity_Prediction, fill = activity), 
           stat = "identity", position = "dodge", alpha = 0.5) +
  geom_point(data = activity_plot_data, aes(x = activity, y = predicted_prob, color = activity), 
             position = position_dodge(width = 0.9), size = 3) +
  scale_fill_brewer(palette = "Set1") + 
  scale_color_brewer(palette = "Set1") + 
  labs(title = "Actual vs. Predicted Obesity by Activity Level",
       x = "Activity Level", y = "Proportion") +
  theme_minimal() +
  theme(legend.position = "none") 

```



By observation, it is evident that the model's prediction was fairly close to what the CCES data showed. The trend remains the same for each result. However, gender and education were predicted to have a higher sentiment of voting for Joe Biden while age had a lower sentiment. 

It is worth nothing though that in @fig-pactivity, all age categories showed polling data of above 50% to vote for Biden. Now with the lower average vote, the older age categories of "45-64" and "65+" are leaning towards Trump. On @fig-pobesity for the lower education groups, the "No-HS" group which was at just about 50% is now above it, and the "High School Graduate" is also closer to voting for Biden. While this may seem marginal, close elections where voter sentiment is close to 50% would be largely impacted by changes like this. Although ultimately this is not an accurate predictor for who would win the election, only which groups would vote for who.

# Discussion


# Weaknesses and Next Steps
\newpage

# References